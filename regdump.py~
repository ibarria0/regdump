#!/usr/bin/python
import sys
import argparse
import os
import requests
import logging.config
import yaml
from bs4 import BeautifulSoup,SoupStrainer
    
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker

from itertools import izip
import Classes
import re
from modules import parser
from modules import crawler

abspath = os.path.abspath(__file__)
dname = os.path.dirname(abspath)
os.chdir(dname)

# create logger
logging.config.dictConfig(yaml.load(open('logging.yaml','r').read()))
logger = logging.getLogger('regdump')
logger.info('regdump started')

db_url = 'postgresql+psycopg2://' + os.environ['PANAUSER'] + ':' + os.environ['PANAPASS'] + '@localhost/panacompra'
engine = create_engine(db_url,  encoding='latin-1',echo=False)
session_maker = sessionmaker(bind=engine)
session = session_maker()

only_row_tags = SoupStrainer("tr")
a_table = SoupStrainer("table")
consulta = SoupStrainer(id="CONSULTA")

sociedad = Classes.Sociedad('Poroto', 613519)

print id(sociedad), id(crawler.scrape_sociedad(sociedad))
